

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Probabilistic generalized Polynomial Chaos Expansion &mdash; UQit 1.0.3 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> UQit
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../UQit_core_/instl_dep.html">Installation and Dependencies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../UQit_core_/codes_list.html">List of core codes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../UQit_core_/terminology.html">Overview &amp; Terminology</a></li>
<li class="toctree-l1"><a class="reference internal" href="../UQit_core_/sampling.html">Sampling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../UQit_core_/surrogate.html">Surrogates</a></li>
<li class="toctree-l1"><a class="reference internal" href="../UQit_core_/uqFWD.html">UQ Forward Problem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../UQit_core_/gsa.html">Global Sensitivity Analysis (GSA)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../UQit_core_/others.html">Other Core Codes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bib.html">Bibliography</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">UQit</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Probabilistic generalized Polynomial Chaos Expansion</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/examples/ppce.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container,
div.nbinput.container div.prompt,
div.nbinput.container div.input_area,
div.nbinput.container div[class*=highlight],
div.nbinput.container div[class*=highlight] pre,
div.nboutput.container,
div.nboutput.container div.prompt,
div.nboutput.container div.output_area,
div.nboutput.container div[class*=highlight],
div.nboutput.container div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="Probabilistic-generalized-Polynomial-Chaos-Expansion">
<h1>Probabilistic generalized Polynomial Chaos Expansion<a class="headerlink" href="#Probabilistic-generalized-Polynomial-Chaos-Expansion" title="Permalink to this headline">¶</a></h1>
<p>Saleh Rezaeiravesh, <a class="reference external" href="mailto:salehr&#37;&#52;&#48;kth&#46;se">salehr<span>&#64;</span>kth<span>&#46;</span>se</a> SimEx/FLOW, Engineering Mechanics, KTH Royal Institute of Technology, Stockholm, Sweden</p>
<p>The aim of this notebook is to show how to use <code class="docutils literal notranslate"><span class="pre">UQit</span></code> for non-intrusive probabilistic gPCE, hereafter called PPCE. In practice, we have the parameter samples and associated values of the model response. Therefore, we only want to construct the PPCE and estimate statistical moments of the model function due to the variability of the uncertain parameters. This basically means much of the coding in the following examples is not required. The theory about PPCE can be studied from
<a class="reference external" href="https://ore.exeter.ac.uk/repository/handle/10871/29296?show=full">Owen</a> and <a class="reference external" href="https://arxiv.org/pdf/2007.07071.pdf">Rezaeiravesh et. al</a>.</p>
<p>Consider parameter <span class="math notranslate nohighlight">\(\mathbf{q}\in \mathbb{Q}\subset\mathbb{R}^p\)</span> which have a known distribution. Furthermore, the distribution of each parameter is assumed to be among what is defined in the standard generalized PCE. The explicit form of the simulator <span class="math notranslate nohighlight">\(f(q)\)</span> is not known. However, the noisy observations are assumed to be generated as,</p>
<div class="math notranslate nohighlight">
\[y=f(q)+\varepsilon\]</div>
<p>where <span class="math notranslate nohighlight">\(\varepsilon\sim\mathcal{N}(0,\sigma^2)\)</span>. If <span class="math notranslate nohighlight">\(\sigma\)</span> is fixed (iid samples), we have homoscedastic noise and if <span class="math notranslate nohighlight">\(\sigma\)</span> is observation-dependent then the noise is heteroscedastic. To estimate <span class="math notranslate nohighlight">\(\mathbb{E}[f(q)]\)</span> and <span class="math notranslate nohighlight">\(\mathbb{V}[f(q)]\)</span> using PPCE approach, we do the followings: * Given training data <span class="math notranslate nohighlight">\(\mathcal{D}=\{(q^{(i)},y^{(i)})\}_{i=1}^n\)</span>, a GPR is constructed. * For each sample drawn from the GPR, we construct a gPCE. Repeating this for <span class="math notranslate nohighlight">\(m\)</span>
samples, by the use of the Monte-Carlo approach stochastic estimates for <span class="math notranslate nohighlight">\(\mathbb{E}[f(q)]\)</span> and <span class="math notranslate nohighlight">\(\mathbb{V}[f(q)]\)</span> are made.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">mt</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">UQit.ppce</span> <span class="kn">import</span> <span class="n">ppce</span>
<span class="kn">import</span> <span class="nn">UQit.pce</span> <span class="k">as</span> <span class="nn">pce</span>
<span class="kn">import</span> <span class="nn">UQit.gpr_torch</span> <span class="k">as</span> <span class="nn">gpr_torch</span>
<span class="kn">import</span> <span class="nn">UQit.stats</span> <span class="k">as</span> <span class="nn">statsUQit</span>
<span class="kn">import</span> <span class="nn">UQit.analyticTestFuncs</span> <span class="k">as</span> <span class="nn">analyticTestFuncs</span>
<span class="kn">import</span> <span class="nn">UQit.write</span> <span class="k">as</span> <span class="nn">writeUQ</span>
<span class="kn">import</span> <span class="nn">UQit.reshaper</span> <span class="k">as</span> <span class="nn">reshaper</span>
<span class="kn">import</span> <span class="nn">UQit.sampling</span> <span class="k">as</span> <span class="nn">sampling</span>
</pre></div>
</div>
</div>
<div class="section" id="Example-1:-PPCE-for-one-uncertain-parameter">
<h2>Example 1: PPCE for one uncertain parameter<a class="headerlink" href="#Example-1:-PPCE-for-one-uncertain-parameter" title="Permalink to this headline">¶</a></h2>
<p>Consider the uncertain parameter <span class="math notranslate nohighlight">\(q\in\mathbb{Q}\subset\mathbb{R}\)</span>. For a set of samples from <span class="math notranslate nohighlight">\(f(q)\)</span>, we want to estimate <span class="math notranslate nohighlight">\(\mathbb{E}[f(q)]\)</span> and <span class="math notranslate nohighlight">\(\mathbb{V}[f(q)]\)</span> using PPCE approach.</p>
<p>First, we need a few functions to synthetically generate training data:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">simulator</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">fType</span><span class="p">,</span><span class="n">qInfo</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Simulator&quot;&quot;&quot;</span>
    <span class="n">yEx</span><span class="o">=</span><span class="n">analyticTestFuncs</span><span class="o">.</span><span class="n">fEx1D</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">fType</span><span class="p">,</span><span class="n">qInfo</span><span class="p">)</span><span class="o">.</span><span class="n">val</span>
    <span class="k">return</span> <span class="n">yEx</span>
<span class="c1">#</span>
<span class="k">def</span> <span class="nf">noiseGen</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">noiseType</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate a 1D numpy array of the standard deviation of the observation noise</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">noiseType</span><span class="o">==</span><span class="s1">&#39;homo&#39;</span><span class="p">:</span> <span class="c1">#homoscedastic noise</span>
       <span class="n">sd</span><span class="o">=</span><span class="mf">0.1</span>   <span class="c1">#(non-zero, to avoid instabilities)</span>
       <span class="n">sdV</span><span class="o">=</span><span class="p">[</span><span class="n">sd</span><span class="p">]</span><span class="o">*</span><span class="n">n</span>
       <span class="n">sdV</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">sdV</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">noiseType</span><span class="o">==</span><span class="s1">&#39;hetero&#39;</span><span class="p">:</span> <span class="c1">#heteroscedastic noise</span>
       <span class="n">sdMin</span><span class="o">=</span><span class="mf">0.02</span>
       <span class="n">sdMax</span><span class="o">=</span><span class="mf">0.2</span>
       <span class="n">sdV</span><span class="o">=</span><span class="n">sdMin</span><span class="o">+</span><span class="p">(</span><span class="n">sdMax</span><span class="o">-</span><span class="n">sdMin</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">sdV</span>
<span class="c1">#</span>
<span class="k">def</span> <span class="nf">trainData</span><span class="p">(</span><span class="n">xInfo</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">noiseType</span><span class="p">,</span><span class="n">trainSamplyType</span><span class="p">,</span><span class="n">distType</span><span class="p">,</span><span class="n">fType</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Create training data D={X,Y}&quot;&quot;&quot;</span>
    <span class="n">X_</span><span class="o">=</span><span class="n">sampling</span><span class="o">.</span><span class="n">trainSample</span><span class="p">(</span><span class="n">sampleType</span><span class="o">=</span><span class="n">trainSampleType</span><span class="p">,</span><span class="n">GQdistType</span><span class="o">=</span><span class="n">distType</span><span class="p">,</span><span class="n">qInfo</span><span class="o">=</span><span class="n">xInfo</span><span class="p">,</span><span class="n">nSamp</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
    <span class="n">x</span><span class="o">=</span><span class="n">X_</span><span class="o">.</span><span class="n">q</span>
    <span class="n">sdV</span><span class="o">=</span><span class="n">noiseGen</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">noiseType</span><span class="p">)</span>
    <span class="n">y</span><span class="o">=</span><span class="n">simulator</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">fType</span><span class="p">,</span><span class="n">xInfo</span><span class="p">)</span> <span class="o">+</span> <span class="n">sdV</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">sdV</span>
</pre></div>
</div>
</div>
<p>Different Settings for the whole process are set as below:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">distType</span><span class="o">=</span><span class="s1">&#39;Unif&#39;</span>      <span class="c1">#type of distribution of the parameter (Acc. gPCE rule)</span>
<span class="n">trainSampleType</span><span class="o">=</span><span class="s1">&#39;unifRand&#39;</span>   <span class="c1">#how to draw the trainining samples, see trainSample in sampling.py</span>
<span class="n">qInfo</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mf">2.5</span><span class="p">]</span>     <span class="c1">#info about the parameter</span>
                    <span class="c1">#if &#39;Unif&#39;, qInfo =[min(q),max(q)]</span>
                    <span class="c1">#if &#39;Norm&#39;, qInfo=[m,v] for q~N(m,v^2)</span>
<span class="n">n</span><span class="o">=</span><span class="mi">35</span>            <span class="c1">#number of training samples in GPR</span>
<span class="n">noiseType</span><span class="o">=</span><span class="s1">&#39;hetero&#39;</span>   <span class="c1">#&#39;homo&#39;=homoscedastic, &#39;hetero&#39;=heterscedastic</span>
<span class="n">nGQtest</span><span class="o">=</span><span class="mi">15</span>         <span class="c1">#number of test points (=Gauss quadrature nodes)</span>
<span class="c1">#GPR options</span>
<span class="n">nIter_gpr</span><span class="o">=</span><span class="mi">1000</span>      <span class="c1">#number of iterations in optimization of hyperparameters</span>
<span class="n">lr_gpr</span>   <span class="o">=</span><span class="mf">0.2</span>       <span class="c1">#learning rate for the optimization of the hyperparameters</span>
<span class="n">convPlot_gpr</span><span class="o">=</span><span class="kc">True</span>   <span class="c1">#plot convergence of the optimization of the GPR hyperparameters</span>
<span class="n">nMC</span><span class="o">=</span><span class="mi">2000</span>            <span class="c1">#number of samples drawn from GPR surrogate to construct estimates</span>
                    <span class="c1">#  for the moments of f(q)</span>
</pre></div>
</div>
</div>
<p>Generate the synthetic training data</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">if</span> <span class="n">distType</span><span class="o">==</span><span class="s1">&#39;Unif&#39;</span><span class="p">:</span>
   <span class="n">fType</span><span class="o">=</span><span class="s1">&#39;type1&#39;</span>
<span class="k">elif</span> <span class="n">distType</span><span class="o">==</span><span class="s1">&#39;Norm&#39;</span><span class="p">:</span>
   <span class="n">fType</span><span class="o">=</span><span class="s1">&#39;type2&#39;</span>
<span class="n">qTrain</span><span class="p">,</span><span class="n">yTrain</span><span class="p">,</span><span class="n">noiseSdev</span><span class="o">=</span><span class="n">trainData</span><span class="p">(</span><span class="n">qInfo</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">noiseType</span><span class="p">,</span><span class="n">trainSampleType</span><span class="p">,</span><span class="n">distType</span><span class="p">,</span><span class="n">fType</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Construct the PPCE</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">ppceDict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;nGQtest&#39;</span><span class="p">:</span><span class="n">nGQtest</span><span class="p">,</span><span class="s1">&#39;qInfo&#39;</span><span class="p">:</span><span class="n">qInfo</span><span class="p">,</span><span class="s1">&#39;distType&#39;</span><span class="p">:</span><span class="n">distType</span><span class="p">,</span>
          <span class="s1">&#39;nIter_gpr&#39;</span><span class="p">:</span><span class="n">nIter_gpr</span><span class="p">,</span><span class="s1">&#39;lr_gpr&#39;</span><span class="p">:</span><span class="n">lr_gpr</span><span class="p">,</span><span class="s1">&#39;convPlot_gpr&#39;</span><span class="p">:</span><span class="n">convPlot_gpr</span><span class="p">,</span><span class="s1">&#39;nMC&#39;</span><span class="p">:</span><span class="n">nMC</span><span class="p">}</span>
<span class="n">ppce_</span><span class="o">=</span><span class="n">ppce</span><span class="p">(</span><span class="n">qTrain</span><span class="p">,</span><span class="n">yTrain</span><span class="p">,</span><span class="n">noiseSdev</span><span class="p">,</span><span class="n">ppceDict</span><span class="p">)</span>
<span class="n">fMean_samples</span><span class="o">=</span><span class="n">ppce_</span><span class="o">.</span><span class="n">fMean_samps</span>
<span class="n">fVar_samples</span><span class="o">=</span><span class="n">ppce_</span><span class="o">.</span><span class="n">fVar_samps</span>
<span class="n">optOut</span><span class="o">=</span><span class="n">ppce_</span><span class="o">.</span><span class="n">optOut</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
... Probabilistic PCE for 1D input parameter.
...... GPR-hyperparameters Optimization, iter 100/1000 - loss: 1.168 - lengthsc: 1.727
...... GPR-hyperparameters Optimization, iter 200/1000 - loss: 1.117 - lengthsc: 1.610
...... GPR-hyperparameters Optimization, iter 300/1000 - loss: 1.109 - lengthsc: 1.574
...... GPR-hyperparameters Optimization, iter 400/1000 - loss: 1.108 - lengthsc: 1.578
...... GPR-hyperparameters Optimization, iter 500/1000 - loss: 1.106 - lengthsc: 1.593
...... GPR-hyperparameters Optimization, iter 600/1000 - loss: 1.105 - lengthsc: 1.612
...... GPR-hyperparameters Optimization, iter 700/1000 - loss: 1.104 - lengthsc: 1.630
...... GPR-hyperparameters Optimization, iter 800/1000 - loss: 1.104 - lengthsc: 1.647
...... GPR-hyperparameters Optimization, iter 900/1000 - loss: 1.103 - lengthsc: 1.664
...... GPR-hyperparameters Optimization, iter 1000/1000 - loss: 1.102 - lengthsc: 1.680
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_ppce_13_1.png" src="../_images/examples_ppce_13_1.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
...... ppce repetition for finding samples of the PCE coefficients, iter = 200/2000
...... ppce repetition for finding samples of the PCE coefficients, iter = 400/2000
...... ppce repetition for finding samples of the PCE coefficients, iter = 600/2000
...... ppce repetition for finding samples of the PCE coefficients, iter = 800/2000
...... ppce repetition for finding samples of the PCE coefficients, iter = 1000/2000
...... ppce repetition for finding samples of the PCE coefficients, iter = 1200/2000
...... ppce repetition for finding samples of the PCE coefficients, iter = 1400/2000
...... ppce repetition for finding samples of the PCE coefficients, iter = 1600/2000
...... ppce repetition for finding samples of the PCE coefficients, iter = 1800/2000
...... ppce repetition for finding samples of the PCE coefficients, iter = 2000/2000
</pre></div></div>
</div>
<p>Compare the estimated moments by PPCE with the exact values:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fEx_</span><span class="o">=</span><span class="n">analyticTestFuncs</span><span class="o">.</span><span class="n">fEx1D</span><span class="p">(</span><span class="n">qTrain</span><span class="p">,</span><span class="n">fType</span><span class="p">,</span><span class="n">qInfo</span><span class="p">)</span>
<span class="n">fEx_</span><span class="o">.</span><span class="n">moments</span><span class="p">(</span><span class="n">qInfo</span><span class="p">)</span>
<span class="n">fMean_ex</span><span class="o">=</span><span class="n">fEx_</span><span class="o">.</span><span class="n">mean</span>
<span class="n">fVar_ex</span><span class="o">=</span><span class="n">fEx_</span><span class="o">.</span><span class="n">var</span>
<span class="n">fMean_mean</span><span class="o">=</span><span class="n">fMean_samples</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">fMean_sdev</span><span class="o">=</span><span class="n">fMean_samples</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
<span class="n">fVar_mean</span><span class="o">=</span><span class="n">fVar_samples</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">fVar_sdev</span><span class="o">=</span><span class="n">fVar_samples</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">writeUQ</span><span class="o">.</span><span class="n">printRepeated</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="mi">80</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&gt;&gt; Exact mean(f) = </span><span class="si">%g</span><span class="s1">&#39;</span> <span class="o">%</span><span class="k">fMean_ex</span>)
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;   ppce estimated: E[mean(f)] = </span><span class="si">%g</span><span class="s1"> , sdev[mean(f)] = </span><span class="si">%g</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">fMean_mean</span><span class="p">,</span><span class="n">fMean_sdev</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&gt;&gt; Exact Var(f) = </span><span class="si">%g</span><span class="s1">&#39;</span> <span class="o">%</span><span class="k">fVar_ex</span>)
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;   ppce estimated: E[Var(f)] = </span><span class="si">%g</span><span class="s1"> , sdev[Var(f)] = </span><span class="si">%g</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">fVar_mean</span><span class="p">,</span><span class="n">fVar_sdev</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
--------------------------------------------------------------------------------
&gt;&gt; Exact mean(f) = 10.948
   ppce estimated: E[mean(f)] = 10.9783 , sdev[mean(f)] = 0.192528
&gt;&gt; Exact Var(f) = 3.18976
   ppce estimated: E[Var(f)] = 3.00365 , sdev[Var(f)] = 0.604616
</pre></div></div>
</div>
<p>Plot histogram and PDF (probability density function) of the mean and variance distributions:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">statsUQit</span><span class="o">.</span><span class="n">pdfFit_uniVar</span><span class="p">(</span><span class="n">fMean_samples</span><span class="p">,</span><span class="kc">True</span><span class="p">,[])</span>
<span class="n">statsUQit</span><span class="o">.</span><span class="n">pdfFit_uniVar</span><span class="p">(</span><span class="n">fVar_samples</span><span class="p">,</span><span class="kc">True</span><span class="p">,[])</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_ppce_17_0.png" src="../_images/examples_ppce_17_0.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_ppce_17_1.png" src="../_images/examples_ppce_17_1.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;statsmodels.nonparametric.kde.KDEUnivariate at 0x7fbecc3298d0&gt;
</pre></div></div>
</div>
<p>Plot the GPR surrogate along with the response from the exact simulator</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">pltOpts</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span><span class="s1">&#39;PPCE, 1D param, </span><span class="si">%s</span><span class="s1">-scedastic noise&#39;</span><span class="o">%</span><span class="k">noiseType</span>}
<span class="n">gpr_torch</span><span class="o">.</span><span class="n">gprPlot</span><span class="p">(</span><span class="n">pltOpts</span><span class="p">)</span><span class="o">.</span><span class="n">torch1d</span><span class="p">(</span><span class="n">optOut</span><span class="p">[</span><span class="s1">&#39;post_f&#39;</span><span class="p">],</span><span class="n">optOut</span><span class="p">[</span><span class="s1">&#39;post_obs&#39;</span><span class="p">],</span><span class="n">qTrain</span><span class="p">,</span><span class="n">yTrain</span><span class="p">,</span>
        <span class="n">optOut</span><span class="p">[</span><span class="s1">&#39;qTest&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">simulator</span><span class="p">(</span><span class="n">optOut</span><span class="p">[</span><span class="s1">&#39;qTest&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">fType</span><span class="p">,</span><span class="n">qInfo</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_ppce_19_0.png" src="../_images/examples_ppce_19_0.png" />
</div>
</div>
</div>
<div class="section" id="Example-2:-PPCE-for-two-parameters">
<h2>Example 2: PPCE for two parameters<a class="headerlink" href="#Example-2:-PPCE-for-two-parameters" title="Permalink to this headline">¶</a></h2>
<p>Using <code class="docutils literal notranslate"><span class="pre">UQit</span></code>, we can apply PPCE to any number of uncertain parameters. Here, we consider two uncertain parameters <span class="math notranslate nohighlight">\(q_1\in\mathbb{Q}_1\)</span> and <span class="math notranslate nohighlight">\(q_2\in\mathbb{Q}_2\)</span>, and use PPCE to estimate statistical moments of <span class="math notranslate nohighlight">\(f(\mathbf{q})\)</span> for <span class="math notranslate nohighlight">\(\mathbf{q}\in \mathbb{Q}_1 \bigotimes \mathbb{Q}_1\)</span>.</p>
<p>First, the functions for generating the synthetic training samples.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">fEx</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">sampleType</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">qInfo</span><span class="p">,</span><span class="n">fExName</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Generate synthetic training data&quot;&quot;&quot;</span>
    <span class="c1">#  (a) xTrain</span>
    <span class="n">nSamp</span><span class="o">=</span><span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">xi</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">q</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">qBound</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">if</span> <span class="n">sampleType</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;LHS&#39;</span> <span class="ow">and</span> <span class="n">sampleType</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;LHS&#39;</span><span class="p">:</span>
       <span class="k">if</span> <span class="n">distType</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;Unif&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">p</span><span class="p">:</span>
          <span class="n">qBound</span><span class="o">=</span><span class="n">qInfo</span>
          <span class="n">xi</span><span class="o">=</span><span class="n">sampling</span><span class="o">.</span><span class="n">LHS_sampling</span><span class="p">(</span><span class="n">nSamp</span><span class="p">,[[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]]</span><span class="o">*</span><span class="n">p</span><span class="p">)</span>
          <span class="n">xTrain</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nSamp</span><span class="p">,</span><span class="n">p</span><span class="p">))</span>
          <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
              <span class="n">xTrain</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">pce</span><span class="o">.</span><span class="n">mapFromUnit</span><span class="p">(</span><span class="n">xi</span><span class="p">[:,</span><span class="n">i</span><span class="p">],</span><span class="n">qBound</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
          <span class="n">fEx_</span><span class="o">=</span><span class="n">analyticTestFuncs</span><span class="o">.</span><span class="n">fEx2D</span><span class="p">(</span><span class="n">xTrain</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">xTrain</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span><span class="n">fExName</span><span class="p">,</span><span class="s1">&#39;comp&#39;</span><span class="p">)</span>
       <span class="k">else</span><span class="p">:</span>
          <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;LHS works only when all q have &#39;Unif&#39; distribution.&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
       <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
           <span class="n">samps</span><span class="o">=</span><span class="n">sampling</span><span class="o">.</span><span class="n">trainSample</span><span class="p">(</span><span class="n">sampleType</span><span class="o">=</span><span class="n">sampleType</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">GQdistType</span><span class="o">=</span><span class="n">distType</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                   <span class="n">qInfo</span><span class="o">=</span><span class="n">qInfo</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">nSamp</span><span class="o">=</span><span class="n">n</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
           <span class="n">q</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">samps</span><span class="o">.</span><span class="n">q</span><span class="p">)</span>
       <span class="n">xTrain</span><span class="o">=</span><span class="n">reshaper</span><span class="o">.</span><span class="n">vecs2grid</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
       <span class="n">fEx_</span><span class="o">=</span><span class="n">analyticTestFuncs</span><span class="o">.</span><span class="n">fEx2D</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">fExName</span><span class="p">,</span><span class="s1">&#39;tensorProd&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">xTrain</span><span class="p">,</span><span class="n">fEx_</span>
<span class="c1">#</span>
<span class="k">def</span> <span class="nf">trainDataGen</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">sampleType</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">qInfo</span><span class="p">,</span><span class="n">fExName</span><span class="p">,</span><span class="n">noiseType</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Generate synthetic training data&quot;&quot;&quot;</span>
    <span class="c1">#  (a) xTrain and noise-free yTrain</span>
    <span class="n">xTrain</span><span class="p">,</span><span class="n">fEx_</span><span class="o">=</span><span class="n">fEx</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">sampleType</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">qInfo</span><span class="p">,</span><span class="n">fExName</span><span class="p">)</span>
    <span class="n">yTrain_noiseFree</span><span class="o">=</span><span class="n">fEx_</span><span class="o">.</span><span class="n">val</span>
    <span class="n">nSamp</span><span class="o">=</span><span class="n">xTrain</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="c1">#  (b) set the sdev of the observation noise</span>
    <span class="n">noiseSdev</span><span class="o">=</span><span class="n">noiseGen</span><span class="p">(</span><span class="n">nSamp</span><span class="p">,</span><span class="n">noiseType</span><span class="p">,</span><span class="n">xTrain</span><span class="p">,</span><span class="n">fExName</span><span class="p">)</span>
    <span class="c1">#  (c) Training data</span>
    <span class="n">yTrain</span><span class="o">=</span><span class="n">yTrain_noiseFree</span><span class="o">+</span><span class="n">noiseSdev</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">nSamp</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">xTrain</span><span class="p">,</span><span class="n">yTrain</span><span class="p">,</span><span class="n">noiseSdev</span><span class="p">,</span><span class="n">yTrain_noiseFree</span><span class="p">,</span><span class="n">fEx_</span>
<span class="c1">#</span>
<span class="k">def</span> <span class="nf">noiseGen</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">noiseType</span><span class="p">,</span><span class="n">xTrain</span><span class="p">,</span><span class="n">fExName</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Generate a 1D numpy array of standard deviation of the observation noise&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">noiseType</span><span class="o">==</span><span class="s1">&#39;homo&#39;</span><span class="p">:</span>
       <span class="n">sd</span><span class="o">=</span><span class="mf">0.2</span>   <span class="c1">#(non-zero, to avoid instabilities)</span>
       <span class="n">sdV</span><span class="o">=</span><span class="n">sd</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">noiseType</span><span class="o">==</span><span class="s1">&#39;hetero&#39;</span><span class="p">:</span>
       <span class="n">sdV</span><span class="o">=</span><span class="mf">0.1</span><span class="o">*</span><span class="p">(</span><span class="n">analyticTestFuncs</span><span class="o">.</span><span class="n">fEx2D</span><span class="p">(</span><span class="n">xTrain</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">xTrain</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span><span class="n">fExName</span><span class="p">,</span><span class="s1">&#39;comp&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">val</span><span class="o">+</span><span class="mf">0.001</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">sdV</span>
</pre></div>
</div>
</div>
<p>Settings:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#settings for parameters and data</span>
<span class="n">qInfo</span><span class="o">=</span><span class="p">[[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">],[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]]</span>    <span class="c1">#info about the parameter</span>
                         <span class="c1">#if &#39;Unif&#39;, qInfo =[min(q),max(q)]</span>
                         <span class="c1">#if &#39;Norm&#39;, qInfo=[m,v] for q~N(m,v^2)</span>
<span class="n">distType</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Unif&#39;</span><span class="p">,</span><span class="s1">&#39;Unif&#39;</span><span class="p">]</span>    <span class="c1">#distribution type of parameters</span>
<span class="n">fExName</span><span class="o">=</span><span class="s1">&#39;type1&#39;</span>          <span class="c1">#name of simulator to generate synthetic dat</span>
                         <span class="c1">#see analyticTestFuncs.fEx2D()</span>
<span class="n">trainSampleType</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;LHS&#39;</span><span class="p">,</span><span class="s1">&#39;LHS&#39;</span><span class="p">]</span>   <span class="c1">#sampling type, see trainSample in sampling.py</span>
<span class="n">n</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">12</span><span class="p">]</span>               <span class="c1">#number of training samples for each parameter.</span>
                        <span class="c1">#note: n[0]*n[1]&lt;128, due to GpyTorch</span>
<span class="n">noiseType</span><span class="o">=</span><span class="s1">&#39;hetero&#39;</span>      <span class="c1">#type of observation noise</span>
                        <span class="c1">#&#39;homo&#39;=homoscedastic, &#39;hetero&#39;=heterscedastic</span>
<span class="c1">#options for GPR</span>
<span class="n">nIter_gpr</span><span class="o">=</span><span class="mi">1000</span>      <span class="c1">#number of iterations in optimization of hyperparameters</span>
<span class="n">lr_gpr</span>   <span class="o">=</span><span class="mf">0.1</span>       <span class="c1">#learning rate for the optimization of the hyperparameters</span>
<span class="n">convPlot_gpr</span><span class="o">=</span><span class="kc">True</span>   <span class="c1">#plot convergence of optimization of the GPR hyperparameters</span>
<span class="c1">#options for Gauss quadrature test nodes</span>
<span class="n">nGQtest</span><span class="o">=</span><span class="p">[</span><span class="mi">18</span><span class="p">,</span><span class="mi">18</span><span class="p">]</span>     <span class="c1">#number of test samples in each param dimension</span>
<span class="n">nMC</span><span class="o">=</span><span class="mi">1000</span>             <span class="c1">#number of samples drawn from GPR surrogate to construct estimates</span>
                    <span class="c1"># for the moments of f(q)</span>
</pre></div>
</div>
</div>
<p>Generate synthetic training data</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">p</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">distType</span><span class="p">)</span>
<span class="n">qTrain</span><span class="p">,</span><span class="n">yTrain</span><span class="p">,</span><span class="n">noiseSdev</span><span class="p">,</span><span class="n">yTrain_noiseFree</span><span class="p">,</span><span class="n">fEx_</span><span class="o">=</span><span class="n">trainDataGen</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">trainSampleType</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">qInfo</span><span class="p">,</span><span class="n">fExName</span><span class="p">,</span><span class="n">noiseType</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Construct the PPCE</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">ppceDict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;nGQtest&#39;</span><span class="p">:</span><span class="n">nGQtest</span><span class="p">,</span><span class="s1">&#39;qInfo&#39;</span><span class="p">:</span><span class="n">qInfo</span><span class="p">,</span><span class="s1">&#39;distType&#39;</span><span class="p">:</span><span class="n">distType</span><span class="p">,</span><span class="s1">&#39;nIter_gpr&#39;</span><span class="p">:</span><span class="n">nIter_gpr</span><span class="p">,</span>
          <span class="s1">&#39;lr_gpr&#39;</span><span class="p">:</span><span class="n">lr_gpr</span><span class="p">,</span><span class="s1">&#39;convPlot_gpr&#39;</span><span class="p">:</span><span class="n">convPlot_gpr</span><span class="p">,</span><span class="s1">&#39;nMC&#39;</span><span class="p">:</span><span class="n">nMC</span><span class="p">}</span>
<span class="n">ppce_</span><span class="o">=</span><span class="n">ppce</span><span class="p">(</span><span class="n">qTrain</span><span class="p">,</span><span class="n">yTrain</span><span class="p">,</span><span class="n">noiseSdev</span><span class="p">,</span><span class="n">ppceDict</span><span class="p">)</span>
<span class="n">optOut</span><span class="o">=</span><span class="n">ppce_</span><span class="o">.</span><span class="n">optOut</span>
<span class="n">fMean_samples</span><span class="o">=</span><span class="n">ppce_</span><span class="o">.</span><span class="n">fMean_samps</span>
<span class="n">fVar_samples</span><span class="o">=</span><span class="n">ppce_</span><span class="o">.</span><span class="n">fVar_samps</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
... Probabilistic PCE for 2-D input parameter.
...... GPR-hyperparameters Optimization, iter 100/1000 - loss: 0.747  lengthscales=1.014 0.971
...... GPR-hyperparameters Optimization, iter 200/1000 - loss: 0.739  lengthscales=1.071 1.033
...... GPR-hyperparameters Optimization, iter 300/1000 - loss: 0.737  lengthscales=1.101 1.065
...... GPR-hyperparameters Optimization, iter 400/1000 - loss: 0.737  lengthscales=1.120 1.084
...... GPR-hyperparameters Optimization, iter 500/1000 - loss: 0.736  lengthscales=1.132 1.096
...... GPR-hyperparameters Optimization, iter 600/1000 - loss: 0.736  lengthscales=1.139 1.104
...... GPR-hyperparameters Optimization, iter 700/1000 - loss: 0.736  lengthscales=1.144 1.109
...... GPR-hyperparameters Optimization, iter 800/1000 - loss: 0.736  lengthscales=1.147 1.111
...... GPR-hyperparameters Optimization, iter 900/1000 - loss: 0.736  lengthscales=1.148 1.113
...... GPR-hyperparameters Optimization, iter 1000/1000 - loss: 0.736  lengthscales=1.149 1.114
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_ppce_29_1.png" src="../_images/examples_ppce_29_1.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
...... ppce repetition for finding samples of the PCE coefficients, iter = 100/1000
...... ppce repetition for finding samples of the PCE coefficients, iter = 200/1000
...... ppce repetition for finding samples of the PCE coefficients, iter = 300/1000
...... ppce repetition for finding samples of the PCE coefficients, iter = 400/1000
...... ppce repetition for finding samples of the PCE coefficients, iter = 500/1000
...... ppce repetition for finding samples of the PCE coefficients, iter = 600/1000
...... ppce repetition for finding samples of the PCE coefficients, iter = 700/1000
...... ppce repetition for finding samples of the PCE coefficients, iter = 800/1000
...... ppce repetition for finding samples of the PCE coefficients, iter = 900/1000
...... ppce repetition for finding samples of the PCE coefficients, iter = 1000/1000
</pre></div></div>
</div>
<p>Estimate reference mean and varaiance of <span class="math notranslate nohighlight">\(f(q)\)</span> using the Monte-Carlo approach</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fEx_</span><span class="o">.</span><span class="n">moments</span><span class="p">(</span><span class="n">distType</span><span class="p">,</span><span class="n">qInfo</span><span class="p">)</span>
<span class="n">fMean_mc</span><span class="o">=</span><span class="n">fEx_</span><span class="o">.</span><span class="n">mean</span>
<span class="n">fVar_mc</span><span class="o">=</span><span class="n">fEx_</span><span class="o">.</span><span class="n">var</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
... Reference moments are calculated by the Monte-Carlo method with 100000 samples
</pre></div></div>
</div>
<p>Postprocess, plots, and comparison between the estimated moments of <span class="math notranslate nohighlight">\(f(q)\)</span> with the reference values.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#   (a) plot the exact and GPR response surfaces</span>
<span class="n">gpr_torch</span><span class="o">.</span><span class="n">gprPlot</span><span class="p">()</span><span class="o">.</span><span class="n">torch2d_3dSurf</span><span class="p">(</span><span class="n">qTrain</span><span class="p">,</span><span class="n">yTrain</span><span class="p">,</span><span class="n">optOut</span><span class="p">[</span><span class="s1">&#39;qTest&#39;</span><span class="p">],</span><span class="n">optOut</span><span class="p">[</span><span class="s1">&#39;post_obs&#39;</span><span class="p">])</span>
<span class="c1">#   (b) plot histogram and fitted pdf of the mean and variance distributions</span>
<span class="n">statsUQit</span><span class="o">.</span><span class="n">pdfFit_uniVar</span><span class="p">(</span><span class="n">fMean_samples</span><span class="p">,</span><span class="kc">True</span><span class="p">,[])</span>
<span class="n">statsUQit</span><span class="o">.</span><span class="n">pdfFit_uniVar</span><span class="p">(</span><span class="n">fVar_samples</span><span class="p">,</span><span class="kc">True</span><span class="p">,[])</span>
<span class="c1">#   (c) compare the reference moments with the estimated values by ppce</span>
<span class="n">fMean_mean</span><span class="o">=</span><span class="n">fMean_samples</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">fMean_sdev</span><span class="o">=</span><span class="n">fMean_samples</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
<span class="n">fVar_mean</span><span class="o">=</span><span class="n">fVar_samples</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">fVar_sdev</span><span class="o">=</span><span class="n">fVar_samples</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">writeUQ</span><span class="o">.</span><span class="n">printRepeated</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="mi">80</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Reference mean(f) = </span><span class="si">%g</span><span class="s1">&#39;</span> <span class="o">%</span><span class="k">fMean_mc</span>)
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;PPCE estimated: E[mean(f)] = </span><span class="si">%g</span><span class="s1"> , sdev[mean(f)] = </span><span class="si">%g</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">fMean_mean</span><span class="p">,</span><span class="n">fMean_sdev</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Reference var(f) = </span><span class="si">%g</span><span class="s1">&#39;</span> <span class="o">%</span><span class="k">fVar_mc</span>)
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;PPCE estimated: E[var(f)] = </span><span class="si">%g</span><span class="s1"> , sdev[var(f)] = </span><span class="si">%g</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">fVar_mean</span><span class="p">,</span><span class="n">fVar_sdev</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_ppce_33_0.png" src="../_images/examples_ppce_33_0.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_ppce_33_1.png" src="../_images/examples_ppce_33_1.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_ppce_33_2.png" src="../_images/examples_ppce_33_2.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
--------------------------------------------------------------------------------
Reference mean(f) = 0.534414
PPCE estimated: E[mean(f)] = 0.476933 , sdev[mean(f)] = 0.0314585
Reference var(f) = 5.92556
PPCE estimated: E[var(f)] = 5.42129 , sdev[var(f)] = 0.251345
</pre></div></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Saleh Rezaeiravesh

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>